---
kind: article
title: VMware Fusion Linked Clones
created_at: 2012-02-25
author: Christoph Leygraf
---

<p>VMware Fusion ist deutlich einfacher gestrickt, als sein Pendant auf dem PC, VMware Workstation. Obwohl die virtuellen Maschinen zwischen beiden Programmen problemlos austauschbar sind, fehlen VMware Fusion doch einige Verwaltungsfunktionen. Ich vermisse besonders eine grafische Netzwerkkonfiguration (siehe <a href="http://vleygraf.de/blogs/cleygraf/zusaetzliche-netzwerke-vmware-fusion-4">hier</a>) und die umfangreichen Möglichkeiten, virtuelle Maschinen zu klonen. Eine virtuelle Maschine zu klonen, ist natürlich auch ohne Unterstützung von VMware recht simpel: man kopiert einfach die gesamte virtuelle Maschine im Finder, ändert den Name und öffnet die Datei (ja, eigentlich ein Verzeichnis bzw. Paket) durch einen Doppelklick. VMware Fusion fragt dann noch, ob man die virtuelle Maschine verschoben oder kopiert hat und schon hat man einen <em>Clone</em>. Der Nachteil dieser Methode ist, dass man jetzt die gleichen Daten zweimal auf der Platte hat. Und wenn man, wie ich, die virtuelle Maschinen auf SSDs unterbringt, ist das sehr unschön, da dieser Plattenplatz besonders teuer ist. Die Lösung dafür heißt <em>Linked Clone</em>. Das kann natürlich VMware Workstation von Hause aus, aber weder VMware Fusion noch der Finder unterstützen einem dabei. Jetzt sind diese <em>Linked Clones</em> nichts wirklich neues, mit etwas Bastelei geht das schon lange. Wie das am Besten mit VMware Fusion bewerkstelligt wird, ist unter anderem <a href="http://nefariousdesigns.co.uk/archive/2009/09/virtualised-development-environments-on-a-mac/">hier</a> und <a href="http://communities.vmware.com/docs/DOC-5611">hier</a> nachzulesen. Das Verfahren ist aufgrund der notwendigen Handarbeit von dem bei VMware Workstation üblichen Vorgehen weit entfernt. Das muss aber nicht sein, wenn man noch einen Schritt weiter geht. Den <em>Linked Clone</em>, den man zum Schluss erhält, nutzt man nicht direkt, sondern nimmt Ihn als <em>Template</em> oder <em>Golden Image</em>. Dieses <em>Template</em> fasst man nicht mehr an, sondern kopiert es mit dem Finder, benennt es um, startet es und antwortet auf die Frage, ob man die virtuelle Maschine kopiert oder verschoben hat, mit “kopiert”! Schon hat man eine neue virtuelle Maschine, und, da das Template sehr klein ist, mein Windows 2008-R2 Template ist 28 MB gross, geht das schön schnell.</p><p>Noch ein paar Anmerkungen zum Vorgehen:</p><ul><li>Die virtuelle Festplatte der Vorlage sollte in 2 GB große Segmente aufgeteilt sein (Standard). Dann ist die in der vmx-Datei angegebene virtuelle Festplatte nämlich nur eine Textdatei, die lediglich Metainformationen beinhaltet. Bestandteil der Metadaten sind die Verweise auf die eigentlichen Datensegmente (“Extents”), die sich leicht mit einem Texteditor bearbeiten lassen.</li><li>Ich verwende im Gegensatz zu dieser Beschreibung bei den Verweisen auf die Datensegmente keinen absoluten Pfade, sondern einen relativen Pfad, wie z. B. <code>RW 4192256 SPARSE "../Win2k8R2-Disk/Win2k8R2-s001.vmdk"</code>. Bei mir befinden sich alle virtuellen Maschinen und Templates in einem Verzeichniss. Wird ein <em>Linked Clone</em> jetzt zusammen mit dem Verzeichnis der Template-Festplatte woanders hin kopiert, ist dieser - im Gegensatz zur Variante mit absoluten Pfadnamen - weiterhin ohne Anpassungen lauffähig.</li><li>Schauen wir uns das Verzeichnis der virtuellen Maschinen mal genau an:</li></ul><p>&nbsp;</p> <pre><code>cleygraf@Vigor9 { …ments/Virtual Machines.localized $ ls -al total 32 drwxr-xr-x 13 cleygraf staff 476 15 Feb 10:10 . drwx——+ 15 cleygraf staff 646 15 Feb 08:52 .. -rw-r–r–@ 1 cleygraf staff 15364 15 Feb 10:10 .DS_Store drwxr-xr-x 2 cleygraf staff 340 15 Nov 03:37 .localized drwxr-xr-x@ 8 cleygraf staff 1428 15 Feb 18:31 AD.lab.leyux.org.vmwarevm drwxr-xr-x@ 3 cleygraf staff 782 29 Jan 19:10 ESX41–1.lab.leyux.org.vmwarevm drwxr-xr-x@ 3 cleygraf staff 782 29 Jan 19:10 ESX41–2.lab.leyux.org.vmwarevm drwxr-xr-x@ 3 cleygraf staff 782 29 Jan 19:10 ESX41–3.lab.leyux.org.vmwarevm drwxr-xr-x@ 6 cleygraf staff 680 15 Feb 18:32 ESX50–1.vmwarevm drwxr-xr-x 5 cleygraf staff 5406 29 Jan 19:10 VC41.lab.leyux.org.vmwarevm drwxr-xr-x 8 cleygraf staff 1496 15 Feb 18:32 VC50.lab.leyux.org.vmwarevm drwxr-xr-x 2 cleygraf staff 816 15 Feb 09:23 Win2k8R2-Disk drwxr-xr-x@ 2 cleygraf staff 1156 15 Feb 09:32 Win2k8R2-Template.vmwarevm drwxr-xr-x@ 7 cleygraf staff 1530 15 Feb 18:31 nas.lab.leyux.org.vmwarevm cleygraf@Vigor9 { …ments/Virtual Machines.localized }$ </code></pre> <p>&nbsp;</p><p>Unser <em>Linked Clone</em> ist hier <code>VC50.lab.leyux.org.vmwarevm</code>. Er ist eine 1:1 Kopie von <code>Win2k8R2-Template.vmwarevm</code>. Deshalb ist dieses 28 MB große Template auch zum Starten des <em>Linked Clones</em> nicht mehr notwendig, es macht nur dessen Erstellung einfach. Was aber zum Starten des <em>Linked Clone</em> zwingend notwendig ist, ist die virtuelle Quellfestplatte, die sich im Verzeichnis <code>Win2k8R2-Disk</code> befindet! Und so sieht dieses Verzeichniss aus:</p> <pre><code> cleygraf@Vigor9 { ...ments/Virtual Machines.localized }$ ls -al ./Win2k8R2-Disk/ total 19735432 drwxr-xr-x   2 cleygraf  staff         816 15 Feb 09:23 . drwxr-xr-x  13 cleygraf  staff         476 15 Feb 10:10 .. -r--------   1 cleygraf  staff  2093547520 15 Feb 09:27 Win2k8R2-s001.vmdk -r--------   1 cleygraf  staff  1986461696 15 Feb 09:27 Win2k8R2-s002.vmdk -r--------   1 cleygraf  staff  2129395712 15 Feb 09:27 Win2k8R2-s003.vmdk -r--------   1 cleygraf  staff  1543897088 15 Feb 09:27 Win2k8R2-s004.vmdk -r--------   1 cleygraf  staff   591921152 15 Feb 09:27 Win2k8R2-s005.vmdk -r--------   1 cleygraf  staff  1754595328 15 Feb 09:27 Win2k8R2-s006.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s007.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s008.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s009.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s010.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s011.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s012.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s013.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s014.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s015.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s016.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s017.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s018.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s019.vmdk -r--------   1 cleygraf  staff      327680 15 Feb 09:27 Win2k8R2-s020.vmdk -r--------   1 cleygraf  staff      131072 15 Feb 09:27 Win2k8R2-s021.vmdk -r--------@  1 cleygraf  staff        1554 15 Feb 09:23 Win2k8R2.vmdk cleygraf@Vigor9 { ...ments/Virtual Machines.localized }$  </code></pre> <p>Man erkennt die Datensegmente <code>Win2k8R2-sXXX.vmdk</code> und die Datei mit den Metadaten <code>Win2k8R2.vmdk</code>. Alle anderen Datei der Quell-VM habe ich gelöscht.</p><ul><li>Auf dem Desktop des Templates habe ich einen Link auf das Programm <em>Sysprep</em> abgelegt, damit ich das nicht vergesse - sonst habe ich wieder zwei Systeme mit der gleichen SID, und das ist einer Domäne gar nicht gut!</li></ul>
